<template>
  <div
    :class="[
      'panel',
      {
        'no-title': !title || !title.length,
        'title-gap': titleLargeGap,
        'single-col': singleColumn,
      },
    ]"
  >
    <h3 class="panel__title">
      {{ title }}
      <a v-if="info?.length && infoType === 'download'" :href="info" :download="info">
        <Icon class-name="panel__info" name="info" />
      </a>
      <a v-else-if="info?.length && infoType === 'link'" :href="info" target="_blank">
        <Icon class-name="panel__info" name="info" />
      </a>
      <template v-else-if="info?.length">
        <Icon class-name="panel__info" name="info" @click.stop.prevent="changeShowTooltipHandler(true, $event)" />
      </template>
      <Popup
        v-if="info?.length && infoTitle?.length"
        :model-value="showTooltip"
        :title="infoTitle!"
        :position="tooltipPosition"
        hide-backdrop
        class-name="tooltip"
        @update:model-value="changeShowTooltipHandler"
      >
        <template #content>
          <div v-html="info" />
        </template>
      </Popup>
    </h3>
    <div class="panel__content">
      <slot />
    </div>
  </div>
</template>

<script lang="ts" setup>
import Icon from '../../viewers/Icon/Icon.vue';
import Popup from '../../viewers/Popup/Popup.vue';
import { ref } from 'vue';
import type { Position } from '../../../type/etc/position';
import { getElementPosition } from '../../../utils/dom';

interface Props {
  title?: string;
  titleLargeGap?: boolean;
  singleColumn?: boolean;
  info?: string;
  infoTitle?: string;
  infoType?: 'default' | 'download' | 'link';
}
defineProps<Props>();

const showTooltip = ref<boolean>(false);
const tooltipPosition = ref<Position>({
  top: 0,
  left: 0,
});

const changeShowTooltipHandler = (newValue: boolean, event?: MouseEvent) => {
  if (event) {
    tooltipPosition.value = getElementPosition(event.target as HTMLElement);
  }

  showTooltip.value = newValue;
};
</script>

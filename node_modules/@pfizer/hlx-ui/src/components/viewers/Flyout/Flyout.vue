<template>
  <Teleport to="body">
    <div
      v-if="modelValue"
      :class="[
        'flyout',
        className,
        {
          large,
          'invert-x': (position.left as number) > center.x,
          'invert-y': (position.top as number) > center.y,
        },
      ]"
      :style="{ top: `${position.top}px`, left: `${position.left}px`, width: `${width}px` }"
      @click="contentClickHandler"
    >
      <slot />
    </div>
  </Teleport>
</template>

<script lang="ts" setup>
import type { Position } from '../../../type/etc/position';
import { onUnmounted, watch } from 'vue';

interface Props {
  className?: string;
  position: Position;
  large?: boolean;
  modelValue: boolean;
  layer?: string;
  disableScrollLock?: boolean;
  interactive?: boolean;
  width?: string;
}

const props = defineProps<Props>();
const emit = defineEmits(['update:modelValue']);

const documentClickHandler = () => {
  emit('update:modelValue', false);
};

const contentClickHandler = (event: MouseEvent) => {
  if (props.interactive) {
    event.preventDefault();
  }
};

const center = Object.freeze({
  x: window.innerWidth / 2,
  y: window.innerHeight / 2,
});

watch(
  () => props.modelValue,
  (newVal: boolean) => {
    if (newVal) {
      setTimeout(() => {
        document.addEventListener('click', documentClickHandler);
      }, 250);
    } else {
      document.removeEventListener('click', documentClickHandler);
    }
  }
);

onUnmounted(() => {
  document.removeEventListener('click', documentClickHandler);
});
</script>

<style lang="scss">
@import './Flyout';
</style>

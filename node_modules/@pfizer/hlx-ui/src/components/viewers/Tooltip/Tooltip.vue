<template>
  <div class="tooltip__wrapper" @mouseover="mouseOverHandler" @mouseout="mouseOutHandler">
    <slot />
    <Flyout v-model="isShow" :position="position" :class-name="`tooltip ${placement}`">
      {{ text }}
    </Flyout>
  </div>
</template>

<script lang="ts" setup>
import Flyout from '../Flyout';
import { ref } from 'vue';
import type { Position } from '../../../type/etc/position';
import { calculateElementCenter } from '../../../utils/dom';
import type { Placement } from './type/Placement';

interface Props {
  placement?: Placement;
  text: string;
}

const props = withDefaults(defineProps<Props>(), {
  placement: 'top',
});

const isShow = ref<boolean>(false);
const position = ref<Position>({
  top: 0,
  left: 0,
});

const resolvePosition = (placement: Placement, el: HTMLElement) => {
  const pos = calculateElementCenter(el);
  const rect = el.getBoundingClientRect();

  switch (placement) {
    case 'bottom':
      return {
        top: rect.top + rect.height,
        left: pos.left,
      };
    case 'left':
      return {
        top: pos.top,
        left: rect.left,
      };
    case 'right':
      return {
        top: pos.top,
        left: rect.left + rect.width,
      };
    case 'top':
      return {
        top: rect.top,
        left: pos.left,
      };
  }
};

const mouseOverHandler = (event: MouseEvent) => {
  const el = event.target as HTMLElement;
  position.value = resolvePosition(props.placement, el);
  isShow.value = true;
  console.log('test', position.value);
};

const mouseOutHandler = () => {
  isShow.value = false;
};
</script>

<style lang="scss">
@import 'Tooltip';
</style>

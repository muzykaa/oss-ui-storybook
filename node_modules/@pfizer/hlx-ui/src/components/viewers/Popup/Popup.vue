<template>
  <dialog
    v-show="modelValue"
    ref="dialogRef"
    :class="['popup', className, mode, { [width as string]: width, hideBackdrop }]"
  >
    <template v-if="modelValue">
      <div v-if="width !== 'full-screen' && title?.length" class="popup__header">
        <div class="popup__title">
          {{ title }}
        </div>
        <button class="invert popup__close-btn" @click="closeClickHandler">
          <Icon name="close" />
        </button>
      </div>
      <div v-if="slots.content" class="popup__content">
        <slot name="content" />
        <button v-if="!title?.length" class="invert popup__close-btn" @click="closeClickHandler">
          <Icon name="close" />
        </button>
      </div>
      <div v-if="slots.actions" class="popup__actions">
        <slot name="actions" />
      </div>
    </template>
  </dialog>
</template>

<script lang="ts" setup>
import Icon from '../Icon/Icon.vue';
import { ref, useSlots, watch } from 'vue';

interface Props {
  title?: string;
  width?: 'wide' | 'slim' | 'full-screen';
  modelValue: boolean;
  hideBackdrop?: boolean;
  className?: string;
  mode: 'default' | 'modal';
}
const props = withDefaults(defineProps<Props>(), {
  mode: 'default',
});
const emit = defineEmits(['update:modelValue']);
const dialogRef = ref<null | HTMLDialogElement>(null);
const slots = useSlots();
const closeClickHandler = () => {
  emit('update:modelValue', false);
};

watch(
  () => props.modelValue,
  (newValue: boolean) => {
    if (!newValue) {
      dialogRef.value?.close();

      return;
    }

    switch (props.mode) {
      case 'default':
        dialogRef.value?.show();
        break;
      case 'modal':
        dialogRef.value?.showModal();
        break;
    }
  }
);
</script>

<style lang="scss">
@import './Popup';
</style>

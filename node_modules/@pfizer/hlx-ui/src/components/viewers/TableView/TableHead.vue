<template>
  <th :class="wrapperClass" @click="itemClickHandler">
    <div class="table-view__heading-text">
      <Icon v-if="props.item.sorting === Sorting.ASC" name="arrow-up" class-name="table-view__sort-indicator" />
      <Icon v-if="props.item.sorting === Sorting.DESC" name="arrow-down" class-name="table-view__sort-indicator" />
      <Icon v-if="props.item.sorting === Sorting.BOTH" name="arrow-up-down" class-name="table-view__sort-indicator" />
      {{ item.label }}
      <Icon v-if="item.icon" :name="item.icon" />
    </div>
  </th>
</template>

<script lang="ts" setup>
import type { TheadProps } from '../../../type/table/Thead';
import { computed } from 'vue';
import { Sorting } from '../../../enum/Sorting';
import Icon from '../Icon/Icon.vue';
import { SORTING_MAP } from './res/sorting-map';

const props = defineProps<{
  item: TheadProps;
}>();
const emit = defineEmits(['sort']);

const wrapperClass = computed<string>(() => {
  let sorted = '';
  if ([Sorting.ASC, Sorting.DESC].indexOf(props.item.sorting as Sorting) > -1) {
    sorted = 'sorted';
  } else if (props.item.sorting === Sorting.BOTH) {
    sorted = 'can-sort';
  }

  return `table-view__heading ${props.item.key} ${sorted}`;
});

const itemClickHandler = (): void => {
  if (!props.item.sorting) {
    return;
  }

  emit('sort', {
    key: props.item.key,
    direction: SORTING_MAP[props.item.sorting],
  });
};
</script>

<template>
  <div v-if="totalPages > 1" class="paginator">
    <button
      class="invert paginator__prev-btn"
      :disabled="prevDisabled"
      @click.prevent="emit('change', currentPage < 2 ? 1 : currentPage - 1)"
    >
      <Icon name="angle-left" />
    </button>

    <template v-if="currentPage > 3">
      <button class="invert paginator__page" @click.prevent="emit('change', 1)">1</button>
      <button v-if="currentPage > 4" class="invert paginator__page" disabled>...</button>
    </template>

    <button
      v-for="page in pagesRange"
      :key="`page-${page}`"
      :class="['invert', 'paginator__page', { active: page === currentPage }]"
      @click.prevent="emit('change', page)"
    >
      {{ page }}
    </button>

    <template v-if="currentPage < totalPages - 1">
      <button v-if="currentPage < totalPages - 2" class="invert paginator__page" disabled>...</button>
      <button class="invert paginator__page" @click.prevent="emit('change', totalPages)">
        {{ totalPages }}
      </button>
    </template>

    <button
      class="invert paginator__next-btn"
      :disabled="nextDisabled"
      @click.prevent="emit('change', currentPage >= totalPages ? totalPages - 1 : currentPage + 1)"
    >
      <Icon name="angle-right" />
    </button>
  </div>
</template>

<script lang="ts" setup>
import Icon from '../Icon/Icon.vue';
import { computed } from 'vue';
import range from 'lodash-es/range';

interface Props {
  currentPage: number;
  totalPages: number;
}
const props = defineProps<Props>();
const emit = defineEmits(['change']);
const prevDisabled = computed(() => props.currentPage < 2);
const nextDisabled = computed(() => props.currentPage >= props.totalPages);
const pagesRange = computed(() => {
  const first = Math.max(props.currentPage - 2, 1);
  const last = Math.min(props.currentPage + 2, props.totalPages + 1);

  return range(first, last);
});
</script>

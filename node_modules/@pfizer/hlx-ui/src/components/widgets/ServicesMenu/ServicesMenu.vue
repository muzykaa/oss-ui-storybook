<template>
  <button :class="['invert', 'services-menu__btn', { show }]" @click="btnClickHandler">
    <SvgImage v-if="show" name="square-menu-fill" class-name="services-menu__icon" />
    <SvgImage v-else name="square-menu" class-name="services-menu__icon" />
  </button>
  <Flyout v-model="show" :position="position" class-name="services-menu">
    <div class="services-menu__inner">
      <ServiceItem v-for="item in items" :key="item.url" :item="item" />
    </div>
  </Flyout>
</template>

<script lang="ts" setup>
import SvgImage from '../../viewers/Icon/Icon.vue';
import { ref, onMounted } from 'vue';
import Flyout from '../../viewers/Flyout/Flyout.vue';
import { getServices } from '../../../services/services';
import type { ServiceMenuResponse } from '../../../type/http/responses/ServiceMenuResponse';
import ServiceItem from './ServiceItem.vue';
import type { Position } from '../../../type/etc/position';

const items = ref<ServiceMenuResponse>([]);
const show = ref<boolean>(false);
const position = ref<Position>({
  top: 0,
  left: 0,
});

const btnClickHandler = (event: MouseEvent) => {
  event.stopPropagation();
  event.preventDefault();

  const rect = (event.target as HTMLElement).getBoundingClientRect();
  position.value = {
    top: rect.top,
    left: rect.left,
  };

  show.value = !show.value;
};

onMounted(async () => {
  items.value = await getServices();
});
</script>

<style lang="scss">
@import './ServicesMenu';
</style>

<template>
  <div :class="['addable-tabs', className]">
    <div
      v-for="item in tabs"
      :key="item.code as string"
      :class="['button', 'addable-tabs__item', { secondary: item.code !== modelValue }]"
      @click="tabClickHandler(item.code as string)"
    >
      {{ item.label }}

      <span v-if="item.badge" class="addable-tabs__item-badge">
        <Icon :name="item.badge.icon" />

        {{ item.badge.label }}
      </span>

      <button v-if="canDelete" class="invert" @click.stop.prevent="tabCloseClickHandler(item)">
        <Icon name="close" />
      </button>
    </div>

    <button v-if="canAdd" type="button" class="invert addable-tabs__add-btn" @click="addClickHandler">
      <Icon name="plus-fill" />
      {{ addBtnText }}
    </button>
  </div>
</template>

<script lang="ts" setup>
import type { Option } from '../../../type/form/Option';
import Icon from '../../viewers/Icon/Icon.vue';
import { computed } from 'vue';
import type { BadgeOption } from '../../../type/form/BadgeOption';

interface Props {
  modelValue: number | string;
  className?: string;
  tabs: BadgeOption[];
  min?: number;
  max?: number;
  addBtnText?: string;
  readonly: boolean;
}

const props = defineProps<Props>();
const emit = defineEmits(['update:modelValue', 'add', 'close']);

const canDelete = computed(() => {
  if (props.readonly) {
    return false;
  }

  return props.min && props.min < props.tabs.length;
});

const canAdd = computed(() => {
  if (props.readonly) {
    return false;
  }

  return props.max && props.max > props.tabs.length;
});

const tabClickHandler = (code: string) => emit('update:modelValue', code);

const addClickHandler = () => emit('add');

const tabCloseClickHandler = (item: Option) => {
  if (item.code === props.modelValue) {
    emit('update:modelValue', '0');
  }

  emit('close', item);
};
</script>

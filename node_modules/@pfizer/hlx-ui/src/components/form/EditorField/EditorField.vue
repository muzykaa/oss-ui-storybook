<template>
  <FieldWrapper
    :label="label"
    :error="error"
    :info="info"
    component="div"
    :class-name="`field textarea-field ${className || ''} ${focused ? 'focus' : ''} ${disabled ? 'disabled' : ''}`"
  >
    <span :ref="setRef" class="textarea-field__ref" />
    <CKEditor.component
      :editor="ClassicEditor"
      :config="editorConfig"
      :model-value="modelValue || ''"
      :disabled="disabled"
      @update:model-value="changeHandler"
    />
  </FieldWrapper>
</template>

<script lang="ts" setup>
import FieldWrapper from '../FieldWrapper/FieldWrapper.vue';
import ClassicEditor from '@ckeditor/ckeditor5-build-classic';
import CKEditor from '@ckeditor/ckeditor5-vue';
import { ref } from 'vue';

interface Props {
  label?: string;
  error?: string;
  disabled?: boolean;
  className?: string;
  name: string;
  modelValue: string;
  placeholder?: string;
  info?: string;
}

const props = defineProps<Props>();
const emit = defineEmits(['update:modelValue']);
const focused = ref<boolean>(false);
const wrapperRef = ref<unknown>(null);
defineExpose({ wrapperRef });

const setRef = (val: unknown) => {
  wrapperRef.value = val;
};

const changeHandler = (value: string) => {
  emit('update:modelValue', value, props.name);
};

const editorConfig = {
  toolbar: {
    items: [
      'heading',
      'fontsize',
      'fontColor',
      '|',
      'bold',
      'italic',
      'strikethrough',
      'subscript',
      'superscript',
      'code',
      '|',
      'undo',
      'redo',
      '|',
      'numberedList',
      'bulletedList',
      'link',
      'blockQuote',
      'codeBlock',
    ],
  },
  placeholder: props.placeholder,
};
</script>

<template>
  <FieldWrapper
    :label="label"
    :error="error"
    :info="info"
    :info-type="infoType"
    :required="required"
    :class-name="`radio-field ${className || ''} ` + `${disabled ? 'disabled' : ''} `"
    component="div"
  >
    <div :ref="setRef" class="radio-field__list">
      <label v-for="option in options" :key="option.code as string">
        <input
          v-model="val"
          type="radio"
          class="radio-field__input"
          :disabled="disabled"
          :value="option.code"
          :name="normalizedName"
          @change="inputChangeHandler"
        />
        {{ option.label }}
      </label>
    </div>
  </FieldWrapper>
</template>

<script lang="ts" setup>
import FieldWrapper from '../FieldWrapper/FieldWrapper.vue';
import type { Option } from '../../../type/form/Option';
import { computed, ref, watch } from 'vue';

interface Props {
  label?: string;
  error?: string;
  disabled?: boolean;
  className?: string;
  name: string;
  info?: string;
  infoType?: 'default' | 'download' | 'link';
  options: Option[];
  modelValue: string;
  required?: boolean;
}

const props = defineProps<Props>();
const emit = defineEmits(['update:modelValue']);
const val = ref<string>(props.modelValue as string);
const wrapperRef = ref<unknown>(null);
defineExpose({ wrapperRef });

const setRef = (_val: unknown) => {
  wrapperRef.value = _val;
};

const inputChangeHandler = (event: Event) =>
  emit('update:modelValue', (event.target as HTMLInputElement).value, props.name);

const normalizedName = computed(() => props.name.replace(/[\][.]/gis, '_'));

watch(props as unknown as object, () => {
  val.value = props.modelValue;
});
</script>

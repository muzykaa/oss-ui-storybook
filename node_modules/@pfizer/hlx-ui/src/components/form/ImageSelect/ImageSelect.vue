<template>
  <FieldWrapper :label="label" :error="error" :class-name="`image-select-field ${className || ''} `" component="div">
    <div :ref="setRef" class="image-select">
      <ImageSelectItem
        v-for="item in options"
        :key="item.code as string"
        :item="item"
        :disabled="disabled"
        :active="(modelValue || []).indexOf(item.code as string) > -1"
        @click="itemClickHandler"
      />
    </div>
  </FieldWrapper>
</template>

<script lang="ts" setup>
import type { ImageOption } from '../../../type/form/ImageOption';
import ImageSelectItem from './ImageSelectItem.vue';
import FieldWrapper from '../../form/FieldWrapper/FieldWrapper.vue';
import { ref } from 'vue';

interface Props {
  options: ImageOption[];
  modelValue?: string[];
  name: string;
  label?: string;
  error?: string;
  disabled?: boolean;
  className?: string;
}

const wrapperRef = ref<unknown>(null);
defineExpose({ wrapperRef });

const setRef = (val: unknown) => {
  wrapperRef.value = val;
};
const props = defineProps<Props>();
const emit = defineEmits(['update:modelValue']);

const itemClickHandler = (item: ImageOption) => {
  const index = (props.modelValue || []).indexOf(item.code as string);
  if (index < 0) {
    emit('update:modelValue', [...(props.modelValue || []), item.code], props.name);
  } else {
    emit(
      'update:modelValue',
      (props.modelValue || []).filter((opt: string) => opt !== item.code),
      props.name
    );
  }
};
</script>

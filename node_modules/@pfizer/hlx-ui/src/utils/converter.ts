import { isNull } from 'lodash';

export function recordToFormData(payload: Record<string, unknown>, path = '', fd = new FormData()) {
  return Object.entries(payload).reduce((data, [key, value]) => {
    const formatedKey = path.length ? `${path}[${key}]` : key;

    if (isNull(value)) {
      return data;
    }

    if (value instanceof Array || value instanceof FileList) {
      for (const [subIndex, subValue] of Object.entries(Array.from(value))) {
        if (subValue instanceof File || typeof subValue !== 'object') {
          data.append(`${formatedKey}[${subIndex}]`, subValue);
        } else {
          recordToFormData(subValue, `${formatedKey}[${subIndex}]`, data);
        }
      }
    } else if (value instanceof File) {
      data.append(formatedKey, value as unknown as string);
    } else if (typeof value === 'boolean') {
      data.append(formatedKey, Number(value) as unknown as string);
    } else if (typeof value === 'object') {
      recordToFormData(value as Record<string, unknown>, formatedKey, data);
    } else {
      data.append(formatedKey, value as unknown as string);
    }

    return data;
  }, fd);
}
